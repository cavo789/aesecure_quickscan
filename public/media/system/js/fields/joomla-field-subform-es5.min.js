!function(){"use strict";function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,a=void 0,"symbol"==typeof(a=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"))?a:String(a)),n)}var o,a}function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},e(t)}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function n(t,e,o){return n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,n){var o=[null];o.push.apply(o,e);var a=new(Function.bind.apply(t,o));return n&&r(a,n.prototype),a},n.apply(null,arguments)}function o(t){var a="function"==typeof Map?new Map:void 0;return o=function(t){if(null===t||(o=t,-1===Function.toString.call(o).indexOf("[native code]")))return t;var o;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,i)}function i(){return n(t,arguments,e(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),r(i,t)},o(t)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}!function(e){var n={SPACE:32,ESC:27,ENTER:13};var i=function(e){var o,i;function u(){var t,r=a(t=e.call(this)||this);if(t.containerWithRows=a(t),t.rowsContainer){var o=t.querySelectorAll(t.rowsContainer);Array.from(o).forEach((function(e){e.closest("joomla-field-subform")===a(t)&&(t.containerWithRows=e)}))}return t.lastRowIndex=t.getRows().length-1,t.template="",t.prepareTemplate(),(t.buttonAdd||t.buttonRemove)&&(t.addEventListener("click",(function(t){var e=null,n=null;if(r.buttonAdd&&(e=t.target.matches(r.buttonAdd)?t.target:t.target.closest(r.buttonAdd)),r.buttonRemove&&(n=t.target.matches(r.buttonRemove)?t.target:t.target.closest(r.buttonRemove)),e&&e.closest("joomla-field-subform")===r){var o=e.closest(r.repeatableElement);o=o&&o.closest("joomla-field-subform")===r?o:null,r.addRow(o),t.preventDefault()}else if(n&&n.closest("joomla-field-subform")===r){var a=n.closest(r.repeatableElement);r.removeRow(a),t.preventDefault()}})),t.addEventListener("keydown",(function(t){if(t.keyCode===n.SPACE){var e=r.buttonAdd&&t.target.matches(r.buttonAdd),o=r.buttonRemove&&t.target.matches(r.buttonRemove);if((e||o)&&t.target.closest("joomla-field-subform")===r){var a=t.target.closest(r.repeatableElement);a=a&&a.closest("joomla-field-subform")===r?a:null,o&&a?r.removeRow(a):e&&r.addRow(a),t.preventDefault()}}}))),t.buttonMove&&t.setUpDragSort(),t}i=e,(o=u).prototype=Object.create(i.prototype),o.prototype.constructor=o,r(o,i);var l,s,b,f=u.prototype;return f.getRows=function(){var t=this,e=Array.from(this.containerWithRows.children),r=[];return e.forEach((function(e){e.matches(t.repeatableElement)&&r.push(e)})),r},f.prepareTemplate=function(){var t=[].slice.call(this.children).filter((function(t){return t.classList.contains("subform-repeatable-template-section")}));if(t[0]&&(this.template=t[0].innerHTML),!this.template)throw new Error("The row template is required for the subform element to work")},f.addRow=function(t){var e,r=this.getRows().length;if(r>=this.maximum)return null;(e="TBODY"===this.containerWithRows.nodeName||"TABLE"===this.containerWithRows.nodeName?document.createElement("tbody"):document.createElement("div")).innerHTML=this.template;var n=e.children[0];return t?t.parentNode.insertBefore(n,t.nextSibling):this.containerWithRows.append(n),this.buttonMove&&(n.setAttribute("draggable","false"),n.setAttribute("aria-grabbed","false"),n.setAttribute("tabindex","0")),n.setAttribute("data-new","1"),this.fixUniqueAttributes(n,r),this.dispatchEvent(new CustomEvent("subform-row-add",{detail:{row:n},bubbles:!0})),n.dispatchEvent(new CustomEvent("joomla:updated",{bubbles:!0,cancelable:!0})),n},f.removeRow=function(t){this.getRows().length<=this.minimum||(this.dispatchEvent(new CustomEvent("subform-row-remove",{detail:{row:t},bubbles:!0})),t.dispatchEvent(new CustomEvent("joomla:removed",{bubbles:!0,cancelable:!0})),t.parentNode.removeChild(t))},f.fixUniqueAttributes=function(t,e){var r=this,n=e||0,o=t.getAttribute("data-group"),a=t.getAttribute("data-base-name"),i=Math.max(this.lastRowIndex,n),u=a+i;this.lastRowIndex=i+1,t.setAttribute("data-group",u);var l=t.querySelectorAll("[name]"),s={};(l=[].slice.call(l).filter((function(t){return"JOOMLA-FIELD-SUBFORM"===t.nodeName?t.parentElement.closest("joomla-field-subform")===r:t.closest("joomla-field-subform")===r}))).forEach((function(e){var r=e,n=r.getAttribute("name"),a=r.getAttribute("aria-describedby"),i=n.replace(/(\[\]$)/g,"").replace(/(\]\[)/g,"__").replace(/\[/g,"_").replace(/\]/g,""),l=n.replace("["+o+"][","["+u+"]["),b=i.replace(o,u).replace(/\W/g,"_"),f=0,c=i;if("checkbox"===r.type&&n.match(/\[\]$/)){if(!(f=s[i]?s[i].length:0)){var d=r.closest("fieldset.checkboxes"),m=t.querySelector('label[for="'+i+'"]');d&&d.setAttribute("id",b),m&&(m.setAttribute("for",b),m.setAttribute("id",b+"-lbl"))}c+=f,b+=f}else if("radio"===r.type){if(!(f=s[i]?s[i].length:0)){var p=r.closest("fieldset.radio"),g=t.querySelector('label[for="'+i+'"]');p&&p.setAttribute("id",b),g&&(g.setAttribute("for",b),g.setAttribute("id",b+"-lbl"))}c+=f,b+=f}s[i]?s[i].push(!0):s[i]=[!0],r.name=l,r.id&&(r.id=b),a&&r.setAttribute("aria-describedby",l+"-desc");var v=t.querySelector('label[for="'+c+'"]');v&&(v.setAttribute("for",b),v.setAttribute("id",b+"-lbl"))}))},f.setUpDragSort=function(){var t=this,e=null,r=!1;function o(e){return!e.form&&e.matches(t.buttonMove)?e:e.closest(t.buttonMove)}function a(t,e){var r=!1;if(t.parentNode===e.parentNode)for(var n=t;n;n=n.previousSibling)if(n===e){r=!0;break}r?e.parentNode.insertBefore(t,e):e.parentNode.insertBefore(t,e.nextSibling)}Array.from(this.getRows()).forEach((function(t){t.setAttribute("draggable","false"),t.setAttribute("aria-grabbed","false"),t.setAttribute("tabindex","0")})),this.addEventListener("touchstart",(function(n){r=!0;var i=o(n.target),u=i?i.closest(t.repeatableElement):null;u&&u.closest("joomla-field-subform")===t&&(e?(u!==e&&a(e,u),e.setAttribute("draggable","false"),e.setAttribute("aria-grabbed","false"),e=null):(u.setAttribute("draggable","true"),u.setAttribute("aria-grabbed","true"),e=u),n.preventDefault())})),this.addEventListener("mousedown",(function(n){var a=n.target;if(!r){var i=o(a),u=i?i.closest(t.repeatableElement):null;u&&u.closest("joomla-field-subform")===t&&(u.setAttribute("draggable","true"),u.setAttribute("aria-grabbed","true"),e=u)}})),this.addEventListener("mouseup",(function(){e&&!r&&(e.setAttribute("draggable","false"),e.setAttribute("aria-grabbed","false"),e=null)})),this.addEventListener("keydown",(function(r){if(!(r.keyCode!==n.ESC&&r.keyCode!==n.SPACE&&r.keyCode!==n.ENTER||r.target.form)&&r.target.matches(t.repeatableElement)){var o=r.target;if(o&&o.closest("joomla-field-subform")===t&&(r.keyCode===n.SPACE&&function(t){return t.ctrlKey||t.metaKey||t.shiftKey}(r)&&("true"===o.getAttribute("aria-grabbed")?(o.setAttribute("draggable","false"),o.setAttribute("aria-grabbed","false"),e=null):(e&&(e.setAttribute("draggable","false"),e.setAttribute("aria-grabbed","false"),e=null),o.setAttribute("draggable","true"),o.setAttribute("aria-grabbed","true"),e=o),r.preventDefault()),r.keyCode===n.ESC&&e&&(e.setAttribute("draggable","false"),e.setAttribute("aria-grabbed","false"),e=null),r.keyCode===n.ENTER&&e)){if(e.setAttribute("draggable","false"),e.setAttribute("aria-grabbed","false"),o===e)return void(e=null);a(e,o),r.preventDefault(),e=null}}})),this.addEventListener("dragstart",(function(t){var r=t.dataTransfer;e&&(r.effectAllowed="move",r.setData("text",""))})),this.addEventListener("dragover",(function(t){e&&t.preventDefault()})),this.addEventListener("dragenter",(function(r){var n=r.target;if(e&&n.parentElement.closest("joomla-field-subform")===t){var o=n.closest(t.repeatableElement);o&&o.closest("joomla-field-subform")===t&&a(e,o)}})),this.addEventListener("dragend",(function(){e&&(e.setAttribute("draggable","false"),e.setAttribute("aria-grabbed","false"),e=null)}))},l=u,(s=[{key:"buttonAdd",get:function(){return this.getAttribute("button-add")}},{key:"buttonRemove",get:function(){return this.getAttribute("button-remove")}},{key:"buttonMove",get:function(){return this.getAttribute("button-move")}},{key:"rowsContainer",get:function(){return this.getAttribute("rows-container")}},{key:"repeatableElement",get:function(){return this.getAttribute("repeatable-element")}},{key:"minimum",get:function(){return this.getAttribute("minimum")}},{key:"maximum",get:function(){return this.getAttribute("maximum")}},{key:"name",get:function(){return this.getAttribute("name")},set:function(t){this.template=this.template.replace(new RegExp(' name="'+this.name.replace(/[[\]]/g,"\\$&"),"g"),' name="'+t),this.setAttribute("name",t)}}])&&t(l.prototype,s),b&&t(l,b),Object.defineProperty(l,"prototype",{writable:!1}),u}(o(HTMLElement));e.define("joomla-field-subform",i)}(customElements)}();